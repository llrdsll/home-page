<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Loja de Ferragens — Demo</title>
<style>
  :root{
    --orange:#F97316;
    --bg:#f7fafc;
    --card:#ffffff;
    --muted:#6b7280;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#111827;line-height:1.45}
  .container{max-width:1100px;margin:0 auto;padding:20px}
  header{background:#fff;display:flex;align-items:center;justify-content:space-between;padding:14px 20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);position:sticky;top:0;z-index:40}
  .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;cursor:pointer}
  .logo{width:44px;height:44px;border-radius:50%;background:var(--orange);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
  .brand-block{display:flex;flex-direction:column}
  .brand-block .title{font-weight:700}
  .brand-block .subtitle{font-size:12px;color:var(--muted);overflow:hidden;white-space:nowrap}
  nav a{margin-left:14px;text-decoration:none;color:inherit;font-weight:600;cursor:pointer}
  nav a.active{color:var(--orange)}
  main{padding:20px 0 120px}
  .hero{background:linear-gradient(180deg,#fffaf0,#fff);border-radius:12px;padding:36px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:12px}
  .hero img{width:120px;height:120px;border-radius:50%;object-fit:cover;border:4px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  .cta-group{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;justify-content:center}
  .btn{padding:10px 16px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:600}
  .btn-primary{background:var(--orange);color:#fff}
  .btn-outline{background:#fff;border:1px solid var(--orange);color:var(--orange)}
  .small{font-size:13px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 14px rgba(2,6,23,0.03);display:flex;flex-direction:column}
  .card img{width:100%;height:160px;object-fit:cover;border-radius:8px}
  .card .price{color:var(--orange);font-weight:700;margin-top:8px}
  .card .actions{margin-top:auto;display:flex;gap:8px}
  .faq-item{border-bottom:1px solid #efefef;padding:10px 0;display:flex;flex-direction:column}
  .faq-q{display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-weight:600}
  .faq-a{margin-top:8px;color:var(--muted);display:none}
  .faq-a.open{display:block}
  .cart-btn{position:fixed;right:18px;bottom:18px;background:#fff;border-radius:28px;padding:10px 14px;box-shadow:0 10px 30px rgba(2,6,23,0.12);display:flex;align-items:center;gap:10px;z-index:80;cursor:pointer}
  .cart-badge{background:var(--orange);color:#fff;border-radius:999px;padding:4px 8px;font-size:13px}
  .cart-panel{position:fixed;right:18px;bottom:76px;width:380px;max-width:94vw;background:#fff;border-radius:12px;padding:14px;box-shadow:0 18px 40px rgba(2,6,23,0.18);z-index:80}
  .cart-item{display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px dashed #f1f1f1}
  .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
  .cart-actions{display:flex;gap:8px;margin-top:12px}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:90}
  .modal{background:#fff;padding:18px;border-radius:12px;max-width:820px;width:94%;display:flex;gap:18px}
  .modal img{width:260px;height:260px;object-fit:cover;border-radius:10px}
  input[type="number"]{width:78px;padding:8px;border-radius:8px;border:1px solid #e6e6e6}
  select, input[type="file"]{padding:8px;border-radius:8px;border:1px solid #e6e6e6}
  @media (max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:620px){
    .grid{grid-template-columns:1fr}
    header{padding:12px}
    .hero img{width:96px;height:96px}
    .modal{flex-direction:column;align-items:center}
    .cart-panel{right:12px;left:12px;width:auto}
  }
  footer{text-align:center;padding:20px;color:var(--muted);font-size:14px}
  .marquee{overflow:hidden;white-space:nowrap;display:inline-block}
  .marquee span{display:inline-block;padding-left:100%;animation:marq 12s linear infinite}
  @keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}

  /* quantity controls (styled) */
  .qty-control{display:flex;align-items:center;gap:8px;margin-top:6px}
  .qty-btn{background:var(--orange);color:#fff;border:none;border-radius:8px;width:34px;height:34px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700;box-shadow:0 6px 14px rgba(249,115,22,0.12);transition:transform .12s}
  .qty-btn:active{transform:scale(.96)}
  .qty-number{min-width:36px;text-align:center;font-weight:700;padding:6px 10px;border-radius:8px;background:#f3f4f6}
  .remove-ghost{background:transparent;border:none;color:#ef4444;cursor:pointer;padding:6px 8px;border-radius:8px;font-weight:600}
</style>
</head>
<body>

<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;padding:0">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="brand" id="home-link" title="Home">
        <img id="logo-img" src="logo.png" alt="logo" style="width:44px;height:44px;border-radius:50%;object-fit:cover;display:block" onerror="this.style.display='none';document.querySelector('.logo').style.display='flex'">
        <div class="logo" style="display:none">A</div>
        <div class="brand-block">
          <div class="title">JFG Metais </div>
          <div class="subtitle"><span class="marquee"><span>Aqui Temos • Suportes de Fixação • Direto da Fábrica</span></span></div>
        </div>
      </div>
    </div>

    <nav>
      <a href="#/" class="nav-link" data-route="/">Home</a>
      <a href="#/loja" class="nav-link" data-route="/loja">Loja</a>
      <a href="#/blog" class="nav-link" data-route="/blog">Blog</a>
      <a href="#/sobre" class="nav-link" data-route="/sobre">Sobre</a>
      <a href="#/trabalhe" class="nav-link" data-route="/trabalhe">Trabalhe conosco</a>
    </nav>
  </div>
</header>

<main class="container" id="app"></main>

<button id="cart-btn" class="cart-btn" aria-label="Abrir carrinho" title="Abrir carrinho">
  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke="#111827" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
  <div style="text-align:left">
    <div style="font-weight:700">Carrinho</div>
    <div class="small" id="cart-summary">0 itens — R$ 0,00</div>
  </div>
  <div class="cart-badge" id="cart-count">0</div>
</button>

<div id="overlays"></div>

<footer>© <span id="year"></span> Loja de Ferragens — criado com carinho</footer>

<!-- EmailJS (opcional) -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
/* =========================
   OLOCO BIXO
   ========================= */

const EMAILJS_ENABLED = false;
const EMAILJS_SERVICE_ID = 'YOUR_EMAILJS_SERVICE_ID';
const EMAILJS_TEMPLATE_ID = 'YOUR_EMAILJS_TEMPLATE_ID';
const EMAILJS_PUBLIC_KEY = 'YOUR_EMAILJS_PUBLIC_KEY';

/* =========================
   Dados (com tamanhos e preços)
   ========================= */
const PHONE_RAW = '11974177315';
const WA_NUMBER = (function(){ const d = String(PHONE_RAW).replace(/\D/g,''); return d.startsWith('55') ? d : '55'+d; })();

const products = [
  {
    title: 'Mão Francesa Normal 20x40',
    img: '1.png',
    sizes: [
      { name: '10cm', price: 13.11 },
      { name: '15cm', price: 13.64 },
      { name: '20cm', price: 14.39 },
      { name: '25cm', price: 14.95 },
      { name: '30cm', price: 15.51 },
      { name: '35cm', price: 16.07 },
      { name: '40cm', price: 16.65 },
      { name: '45cm', price: 17.18 },
      { name: '50cm', price: 17.77 },
      { name: '55cm', price: 18.33 },
      { name: '60cm', price: 18.97 },
      { name: '65cm', price: 19.60 },
      { name: '70cm', price: 20.23 },
      { name: '80cm', price: 21.60 },
      { name: '90cm', price: 22.87 }                  
    ]
  },
  {
    title: 'Bucha Fischer SX',
    img: '10.png',
    sizes: [
      { name: '10mm', price: 0.94 },
      { name: '8mm', price: 0.59 }
    ]
  },
  {
    title: 'Parafuso Sextavado',
    img: '8.png',
    sizes: [
      { name: '1/4x50', price: 0.70 },
      { name: '1/4x60', price: 0.59 },
      { name: '1/4x65', price: 0.62 },
      { name: '1/4x70', price: 0.65 },
      { name: '1/4x75', price: 0.68 },
      { name: '5/16x50', price: 0.84 },
      { name: '5/16x55', price: 0.85 },
      { name: '5/16x60', price: 0.90 },
      { name: '5/16x70', price: 1.07 },
      { name: '5/16x75', price: 1.10 },
      { name: '5/16x80', price: 1.15 },
      { name: '5/16x90', price: 1.45 }
    ]
  },
  {
    title: 'MF Cantoneira 1.1/4 x 1/8 (Média)',
    img: '4.png',
    sizes: [
      { name: '14cm', price: 16.25 },
      { name: '16cm', price: 16.56 },
      { name: '25cm', price: 19.81 },
      { name: '30cm', price: 20.97 },
      { name: '35cm', price: 21.62 },
      { name: '40cm', price: 22.49 },
      { name: '45cm', price: 23.15 },
      { name: '50cm', price: 24.01 },
      { name: '55cm', price: 24.77 },
      { name: '60cm', price: 25.53 },
      { name: '65cm', price: 26.29 },
      { name: '70cm', price: 27.06 }
    ]
  },
  {
    title: 'MF Cantoneira 1.1/2 x 1/8 (Média)',
    img: '25.png',
    sizes: [
      { name: '14cm', price: 17.20 },
      { name: '16cm', price: 17.58 },
      { name: '30cm', price: 23.14 },
      { name: '35cm', price: 24.10 },
      { name: '38cm', price: 24.48 },
      { name: '40cm', price: 25.06 },
      { name: '45cm', price: 26.01 },
      { name: '50cm', price: 26.97 },
      { name: '55cm', price: 27.93 },
      { name: '60cm', price: 28.89 },
      { name: '65cm', price: 29.85 },
      { name: '70cm', price: 30.80 },
      { name: '80cm', price: 34.64 },
      { name: '90cm', price: 36.55 },
      { name: '100cm', price: 28.47 }
    ]
  },
  {
    title: 'Grapa Tubo 1.1/4 (Leve)',
    img: '26.png',
    sizes: [
      { name: '32cm', price: 12.96 },
      { name: '42cm', price: 13.99 },
      { name: '50cm', price: 14.81 },
      { name: '52cm', price: 15.02 },
      { name: '55cm', price: 15.33 },
      { name: '58cm', price: 15.64 },
      { name: '60cm', price: 15.84 },
      { name: '70cm', price: 16.88 },
      { name: '80cm', price: 17.91 }
    ]
  },
  {
    title: 'Grapa Tubo 32mm (Pesada)',
    img: '26.png',
    sizes: [
      { name: '50cm', price: 18.85 },
      { name: '52cm', price: 19.18 },
      { name: '55cm', price: 19.67 },
      { name: '58cm', price: 20.15 },
      { name: '60cm', price: 20.48 },
      { name: '66cm', price: 21.46 },
      { name: '70cm', price: 22.11 },
      { name: '80cm', price: 23.74 }
    ]
  },
  {
    title: 'Grapa Tubo 38mm (Pesada)',
    img: '26.png',
    sizes: [
      { name: '50cm', price: 49.13 },
      { name: '52cm', price: 50.13 },
      { name: '55cm', price: 51.63 },
      { name: '58cm', price: 53.13 },
      { name: '60cm', price: 53.92 },
      { name: '66cm', price: 57.12 },
      { name: '70cm', price: 57.86 },
      { name: '80cm', price: 64.12 }
    ]
  },
  {
    title: 'Massa Plástica 800g',
    img: '5.png',
    sizes: [
      { name: 'Branca', price: 13.00 },
      { name: 'Chumbar', price: 13.00 },
      { name: 'Preta', price: 13.00 },
      { name: 'Travertino', price: 13.00 },
      { name: 'Verde', price: 13.00 }
    ]
  },
  {
    title: 'Cola P.U',
    img: '7.png',
    sizes: [
      { name: 'Branco', price: 15.99 },
      { name: 'Preto', price: 15.99 }
    ]
  },
  {
    title: 'Bucha Duo Power',
    img: '9.png',
    sizes: [
      { name: '10mm', price: 1.29 }
    ]
  },
  {
    title: 'IV PLAST TJ Baiano',
    img: '11.png',
    sizes: [
      { name: '10mm', price: 0.30 }
    ]
  },
  {
    title: 'Suporte Varal de Teto',
    img: '27.png',
    sizes: [
      { name: 'Regulagem', price: 25.03 }
    ]
  },
  {
    title: 'Cavalete de Regulagem ',
    img: '28.png',
    sizes: [
      { name: 'Tubo', price: 420.00 }
    ]
  },
  {
    title: 'Cavalete de Abrir e Fechar',
    img: '29.png',
    sizes: [
      { name: 'Tubo', price: 168.00 }
    ]
  },
  {
    title: 'Cavalete de Cantoneira ',
    img: '0.png',
    sizes: [
      { name: 'Cantoneira', price: 330.00 }
    ]
  },
  {
    title: 'Bucha IV Plast',
    img: '14.png',
    sizes: [
      { name: '8mm', price: 0.10 },
      { name: '10mm', price: 0.20 },
      { name: '12mm', price: 0.26 }
    ]
  },
  {
    title: 'Bucha New Fix Plast',
    img: '12.png',
    sizes: [
      { name: '10mm', price: 0.30 }
    ]
  },
  {
    title: 'Bucha Fischer UX',
    img: '13.png',
    sizes: [
      { name: '10mm', price: 0.73 }
    ]
  },
  {
    title: 'Bucha Argevision',
    img: '15.png',
    sizes: [
      { name: '10mm', price: 1.29 }
    ]
  },
  {
    title: 'Bucha MX Nylon 10',
    img: '16.png',
    sizes: [
      { name: '10mm', price: 1.29 }
    ]
  },
  {
    title: 'Chumbador Parabolt',
    img: '17.png',
    sizes: [
      { name: '1/4x2', price: 1.59 },
      { name: '5/16x2.1/4', price: 2.22 }
    ]
  },
  {
    title: 'Chumbador Ancora',
    img: '18.png',
    sizes: [
      { name: '1/4x2', price: 1.89 },
      { name: '1/4x3', price: 2.22 }
    ]
  },
  {
    title: 'Kit Drywall',
    img: '19.png',
    sizes: [
      { name: '1/4', price: 5.03 },
      { name: '3/16', price: 4.98 }
    ]
  },
  {
    title: 'Bucha MU 10',
    img: '20.png',
    sizes: [
      { name: '10mm', price: 1.29 }
    ]
  },
  {
    title: 'Cantoneiras 38m',
    img: '21.png',
    sizes: [
      { name: '05cm', price: 16.25 },
      { name: '10cm', price: 16.56 },
      { name: '15cm', price: 19.81 },
      { name: '20cm', price: 20.97 },
      { name: '25cm', price: 21.62 },
      { name: '30cm', price: 22.49 },
      { name: '35cm', price: 23.15 },
      { name: '40cm', price: 24.01 },
      { name: '45cm', price: 24.77 },
      { name: '50cm', price: 25.53 },
      { name: '55cm', price: 26.29 },
      { name: '60cm', price: 27.06 },
      { name: '65cm', price: 25.53 },
      { name: '70cm', price: 26.29 }
    ]
  },
  {
    title: 'Cantoneira 32mm',
    img: '21.png',
    sizes: [
      { name: '10cm', price: 6.77 },
      { name: '20cm', price: 8.29 },
      { name: '25cm', price: 9.05 },
      { name: '30cm', price: 9.81 },
      { name: '40cm', price: 11.34 },
      { name: '45cm', price: 12.46 },
      { name: '50cm', price: 12.86 },
      { name: '60cm', price: 14.38 }
    ]
  },
  {
    title: 'MF. Ferro Chato 5/16 x 1.1/4 (Grosso)',
    img: '22.png',
    sizes: [
      { name: '45cm', price: 24.43 },
      { name: '50cm', price: 25.44 },
      { name: '55cm', price: 26.45 },
      { name: '60cm', price: 27.46 }
    ]
  },
  {
    title: 'MF. Ferro Chato 3x16 x 1.1/4 (Médio)',
    img: '22.png',
    sizes: [
      { name: '40cm', price: 21.79 },
      { name: '45cm', price: 22.65 },
      { name: '50cm', price: 23.52 },
      { name: '55cm', price: 24.39 }
    ]
  },
  {
    title: 'MF. Ferro Chato 1/8 x 1.1/4 (Fino)',
    img: '22.png',
    sizes: [
      { name: '40cm', price: 19.29 },
      { name: '45cm', price: 20.00 },
      { name: '50cm', price: 20.62 },
      { name: '55cm', price: 21.83 }
    ]
  },
  { 
   title: ' ̶G̶r̶a̶p̶a̶s̶ ̶P̶e̶r̶f̶i̶l̶ ̶T̶ (esgotado)',
    img: '2.png',
    sizes: [
      { name: '05cm', price: 0.00 },
      { name: '10cm', price: 0.00 },
      { name: '15cm', price: 0.00 },
      { name: '20cm', price: 0.00 },
      { name: '30cm', price: 0.00 },
      { name: '35cm', price: 0.00 },
      { name: '40cm', price: 0.00 },
      { name: '45cm', price: 0.00 },
      { name: '50cm', price: 0.00 },
      { name: '55cm', price: 0.00 },
      { name: '60cm', price: 0.00 },
      { name: '65cm', price: 0.00 },
      { name: '70cm', price: 0.00 },
      { name: '75cm', price: 0.00 },
      { name: '1,20m', price: 0.00 },
      { name: '3m', price: 0.00 }
    ]
  },
  {
    title: ' ̶M̶F̶.̶ ̶P̶e̶r̶f̶i̶l̶ ̶T̶ ̶1̶.̶1̶/̶4̶ ̶(̶M̶é̶d̶i̶o̶)̶ (esgotado)',
    img: '23.png',
    sizes: [
      { name: '20cm', price: 0.00 },
      { name: '25cm', price: 0.00 },
      { name: '30cm', price: 0.00 },
      { name: '35cm', price: 0.00 },
      { name: '40cm', price: 0.00 },
      { name: '45cm', price: 0.00 },
      { name: '50cm', price: 0.00 },
      { name: '55cm', price: 0.00 },
      { name: '60cm', price: 0.00 },
      { name: '65cm', price: 0.00 },
      { name: '70cm', price: 0.00 },
      { name: '75cm', price: 0.00 }
    ]
  },
  {
    title: 'Viga U para divisórias 28x28x28mm',
    img: '999.png',
    sizes: [
      { name: '10cm', price: 10.58 },
      { name: '20cm', price: 12.24 },
      { name: '30cm', price: 13.89 },
      { name: '40cm', price: 18.17 },
      { name: '50cm', price: 34.29 },
      { name: '60cm', price: 39.26 },
      { name: '70cm', price: 45.80 },
      { name: '80cm', price: 50.77 },
      { name: '90cm', price: 55.74 },
      { name: '100cm', price: 62.28 }
    ]
  },
  {
    title: 'Grapa Quadrada 20x20 (Leve)',
    img: '24.png',
    sizes: [
      { name: '25cm', price: 13.77 },
      { name: '30cm', price: 14.16 },
      { name: '35cm', price: 14.41 },
      { name: '40cm', price: 14.95 },
      { name: '45cm', price: 15.24 },
      { name: '50cm', price: 15.63 },
      { name: '55cm', price: 16.92 },
      { name: '60cm', price: 16.41 },
      { name: '65cm', price: 18.96 },
      { name: '70cm', price: 19.64 },
      { name: '80cm', price: 20.72 }
    ]
  },
  {
    title: 'Grapa Quadrada 50x30 (Pesada)',
    img: '24.png',
    sizes: [
      { name: '60cm', price: 26.64 },
      { name: '65cm', price: 28.01 },
      { name: '70cm', price: 29.38 },
      { name: '75cm', price: 30.75 },
      { name: '80cm', price: 32.11 },
      { name: '85cm', price: 34.93 },
      { name: '90cm', price: 36.24 },
      { name: '95cm', price: 37.74 }
    ]
  },
  {
    title: 'Grapa Quadrada 40x40 (Pesada)',
    img: '24.png',
    sizes: [
      { name: '60cm', price: 27.64 },
      { name: '65cm', price: 29.05 },
      { name: '70cm', price: 29.33 },
      { name: '75cm', price: 30.46 },
      { name: '80cm', price: 31.87 },
      { name: '85cm', price: 33.29 },
      { name: '90cm', price: 35.62 },
      { name: '95cm', price: 37.03 }
    ]
  },
  {
    title: ' ̶M̶F̶.̶ ̶P̶e̶r̶f̶i̶l̶ ̶T̶ ̶1̶.̶1̶/̶2̶ ̶(̶G̶r̶o̶s̶s̶o̶)̶ (esgotado)',
    img: '23.png',
    sizes: [
      { name: '40cm', price: 0.00 },
      { name: '45cm', price: 0.00 },
      { name: '50cm', price: 0.00 },
      { name: '55cm', price: 0.00 },
      { name: '60cm', price: 0.00 },
      { name: '65cm', price: 0.00 },
      { name: '70cm', price: 0.00 },
      { name: '75cm', price: 0.00 }
    ]
  },
  {
    title: 'Grade Boca de Lobo',
    img: '3.png',
    sizes: [
      { name: 'Personalizado', price: 0.00 }
    ]
  }
];

const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const formatMoney = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

/* =========================
   Cart (localStorage)
   Cada item no carrinho guarda:
   { skuId, title, img, sizeName, price, qty }
   skuId = product.id + '::' + sizeName (para diferenciar variações)
   ========================= */
let cart = [];
function loadCart(){ try{ cart = JSON.parse(localStorage.getItem('cart_v2')) || []; } catch(e){ cart = []; } updateCartUI(); }
function saveCart(){ localStorage.setItem('cart_v2', JSON.stringify(cart)); updateCartUI(); }

// addToCart recebe product e a variação selecionada (objeto {name, price})
function addToCart(product, sizeObj, qty = 1){
  const skuId = `${product.id}::${sizeObj.name}`;
  const found = cart.find(i=>i.skuId === skuId);
  if(found) found.qty += qty;
  else cart.push({
    skuId,
    productId: product.id,
    title: product.title,
    img: product.img,
    sizeName: sizeObj.name,
    price: Number(sizeObj.price),
    qty
  });
  saveCart();
}
function removeFromCart(index){ if(index>=0 && index<cart.length){ cart.splice(index,1); saveCart(); } }
function clearCart(){ cart = []; saveCart(); }
function cartTotal(){ return cart.reduce((s,i)=>s + (i.price * i.qty), 0); }
function cartCount(){ return cart.reduce((s,i)=>s + i.qty, 0); }
function updateCartUI(){
  $('#cart-count').textContent = cartCount();
  $('#cart-summary').textContent = `${cartCount()} itens — ${formatMoney(cartTotal())}`;
  const panel = document.getElementById('cart-panel'); if(panel) renderCartPanel();
}

/* =========================
   Router & Pages (Home, Loja, Blog, Sobre, Trabalhe)
   ========================= */
function currentRoute(){ return location.hash.replace('#','') || '/'; }
function setActiveNav(){
  const route = currentRoute();
  $$('.nav-link').forEach(a => {
    const href = a.getAttribute('href') || a.dataset.route || '';
    a.classList.toggle('active', href === ('#'+route) || href.replace('#','') === route || a.dataset.route === route);
  });
}
function navigateTo(path){ location.hash = path; }

function renderHome(){
  const app = $('#app');
  app.innerHTML = `
    <section class="hero">
      <img src="hero.png" alt="perfil" onerror="this.src='https://source.unsplash.com/400x400/?workshop,person'">
      <h1 style="font-size:28px;margin:6px 0 0">Bem-vindo à nossa loja</h1>
      <p class="small" style="max-width:760px;margin:8px 0 0">Grapas e Mão Francesas — qualidade, rapidez e preços que cabem no bolso. Promoções especiais para clientes VIPs.</p>
      <div class="cta-group" style="margin-top:14px">
        <button class="btn btn-outline" iSer VIPdestaques">Ser VIP</button>
        <button class="btn btn-primary" id="enter-loja">Acessar a loja</button>
      </div>
    </section>

    <section style="margin-top:24px">
      <h2 style="margin:0 0 12px">Destaques</h2>
      <div class="grid" id="destaques-grid"></div>
    </section>

    <section style="margin-top:18px">
      <h3 style="margin:0 0 10px">Perguntas frequentes</h3>
      <div id="faq-list"></div>
    </section>
  `;
  const grid = $('#destaques-grid');
  products.slice(0,3).forEach(p => {
    const div = document.createElement('div'); div.className = 'card';
    // show first size price as highlight
    const first = p.sizes[0];
    div.innerHTML = `
      <img src="${p.img}" alt="${p.title}" onerror="this.src='https://source.unsplash.com/800x600/?product,tool'">
      <div style="margin-top:8px;font-weight:700">${p.title}</div>
      <div class="price">${formatMoney(first.price)} <span class="small">(${first.name})</span></div>
      <div class="actions" style="margin-top:10px">
        <button class="btn btn-primary quick-buy" data-id="${p.id}">Comprar</button>
        <button class="btn btn-outline details" data-id="${p.id}">Ver</button>
      </div>
    `;
    grid.appendChild(div);
  });

  const faqs = [
    {q:'Como funciona a entrega?', a:'Entregamos em todo o estado de São Paulo em até 4 dias, entregas fora de SP são feitas através de transportadoras parceiras.'},
    {q:'Quais formas de pagamento vocês aceitam?', a:'Aceitamos pagamentos a vista no Pix, transferências bancárias ou a prazo através de boletos e cartões.'},
    {q:'Posso retirar no local?', a:'Claro, temos opção de retirada diretamente na fábrica, temos estacionamento e espaço especial para nossos clientes, venham nos visitar!.'},
    {q:'Os produtos têm garantia?', a:'Sim, todos os produtos têm garantia de 1 ano contra defeitos de fabricação.'},
    {q:'Vocês oferecem descontos para atacado?', a:'Sim, entre em contato pelo WhatsApp para condições especiais.'}
  ];
  const faqList = $('#faq-list');
  faqs.forEach(f=>{
    const item = document.createElement('div'); item.className = 'faq-item';
    item.innerHTML = `<div class="faq-q">${f.q} <span class="small">+</span></div><div class="faq-a">${f.a}</div>`;
    faqList.appendChild(item);
    item.querySelector('.faq-q').addEventListener('click', ()=> {
      const ans = item.querySelector('.faq-a'); const sign = item.querySelector('.faq-q span');
      ans.classList.toggle('open'); sign.textContent = ans.classList.contains('open') ? '−' : '+';
    });
  });

  // events: Comprar (quick-buy) -> add first size; Ver -> modal
  $$('.quick-buy').forEach(btn => btn.addEventListener('click', e => {
    const id = e.currentTarget.dataset.id; const p = products.find(x=>x.id===id);
    if(!p) return;
    const size = p.sizes[0];
    addToCart(p, size, 1); openCartPanel();
  }));
  $$('.details').forEach(btn => btn.addEventListener('click', e => {
    const id = e.currentTarget.dataset.id; const p = products.find(x=>x.id===id);
    openProductModal(p);
  }));
  $('#enter-loja').addEventListener('click', ()=> navigateTo('/loja'));
  $('#see-destaques').addEventListener('click', ()=> { document.getElementById('destaques-grid').scrollIntoView({behavior:'smooth'}); });
}

function renderLoja(){
  const app = $('#app');
  app.innerHTML = `
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;align-items:center">
      <input id="search" placeholder="Buscar produtos..." style="flex:1;padding:10px;border-radius:12px;border:1px solid #e6e6e6" />
      <select id="filter" style="padding:10px;border-radius:12px;border:1px solid #e6e6e6">
        <option value="all">Todos</option>
        <option value="grapas">Grapas</option>
        <option value="mão">Mão Francesa</option>
        <option value="cavaletes">Cavaletes</option>
        <option value="adicionais">Adicionais</option>
      </select>
    </div>
    <div class="grid" id="store-grid"></div>
  `;
  const grid = $('#store-grid');
  function updateStore(){
    grid.innerHTML = '';
    const q = $('#search').value.trim().toLowerCase();
    const f = $('#filter').value;
    const filtered = products.filter(p=>{
      const byFilter = f==='all' ||
        (f==='grapas' && p.title.toLowerCase().includes('grapa')) ||
        (f==='mão' && p.title.toLowerCase().includes('mão')) ||
        (f==='cavaletes' && p.title.toLowerCase().includes('cavalete')) ||
        (f==='adicionais' && p.title.toLowerCase().includes('adicional'));
      return byFilter && p.title.toLowerCase().includes(q);
    });
    filtered.forEach(p=>{
      const first = p.sizes[0];
      const div = document.createElement('div'); div.className='card';
      div.innerHTML = `
        <img src="${p.img}" alt="${p.title}" onerror="this.src='https://source.unsplash.com/800x600/?product,tool'">
        <div style="margin-top:8px;font-weight:700">${p.title}</div>
        <div class="price">${formatMoney(first.price)} <span class="small">(${first.name})</span></div>
        <div class="actions" style="margin-top:10px">
          <button class="btn btn-outline details" data-id="${p.id}">Ver</button>
          <button class="btn btn-primary buy" data-id="${p.id}">Comprar</button>
        </div>
      `;
      grid.appendChild(div);
    });
    // attach events
    $$('.buy').forEach(b=> b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id; const p = products.find(x=>x.id===id);
      if(!p) return;
      const defaultSize = p.sizes[0];
      addToCart(p, defaultSize, 1); updateCartUI();
      const btn = e.currentTarget;
      const old = btn.innerText; btn.innerText = 'Adicionado'; setTimeout(()=>btn.innerText = old, 900);
    }));
    $$('.details').forEach(d=> d.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id; openProductModal(products.find(x=>x.id===id));
    }));
  }
  $('#search').addEventListener('input', updateStore);
  $('#filter').addEventListener('change', updateStore);
  updateStore();
}

function renderBlog(){
  const posts = [
    {id:1, title:'Como escolher a mão francesa ideal', excerpt:'Dicas práticas para selecionar o melhor suporte para prateleiras.'},
    {id:2, title:'Vantagens de comprar direto da fábrica', excerpt:'Economia e garantia de procedência nos seus materiais.'},
    {id:3, title:'Top 5 usos para cavaletes', excerpt:'Ideias criativas e funcionais para usar cavaletes em casa e obra.'}
  ];
  const app = $('#app');
  app.innerHTML = `<h2 style="margin-top:0">Blog</h2>` + posts.map(p=>`
    <div class="card" style="margin-bottom:10px">
      <h3 style="margin:0 0 8px">${p.title}</h3>
      <p class="small" style="margin:0 0 10px">${p.excerpt}</p>
      <a href="#" class="btn btn-outline" style="display:inline-block">Ler mais</a>
    </div>
  `).join('');
}

function renderSobre(){
  const app = $('#app');
  app.innerHTML = `
    <h2 style="margin-top:0">Sobre</h2>
    <p class="small">Somos uma loja de ferragens com tradição em qualidade e atendimento. Nossa missão é entregar soluções eficientes para você.</p>
    <div style="display:flex;justify-content:center;margin:18px 0">
      <img src="sobre.png" style="max-width:100%;border-radius:12px" alt="fabrica" onerror="this.src='https://source.unsplash.com/1000x400/?workshop,tools'">
    </div>
    <p class="small">Se quiser nos seguir, estamos nas redes sociais:</p>
    <div style="display:flex;gap:8px">
      <a href="#" class="btn btn-outline">Instagram</a>
      <a href="#" class="btn btn-outline">LinkedIn</a>
      <a href="#" class="btn btn-outline">Facebook</a>
    </div>
  `;
}

function renderTrabalhe(){
  const app = $('#app');
  app.innerHTML = `
    <h2 style="margin-top:0">Trabalhe conosco</h2>
    <p class="small">Envie seu currículo para as vagas disponíveis. Pode anexar o arquivo; se quiser envio automático, ative EmailJS no topo do arquivo.</p>
    <form id="work-form" class="card" style="padding:16px;max-width:640px">
      <label>Vagas disponíveis</label>
      <select id="vaga" style="width:100%;margin-top:8px;margin-bottom:12px">
        <option>Vendedor</option><option>Estoque</option><option>Marketing</option>
      </select>
      <label>Anexar currículo (opcional)</label>
      <input type="file" id="cv" style="margin-top:8px;margin-bottom:12px" accept=".pdf,.doc,.docx" />
      <div style="display:flex;gap:8px">
        <button class="btn btn-primary" type="submit">Enviar</button>
        <button class="btn btn-outline" type="button" id="clear-cv">Limpar</button>
      </div>
      <div id="work-status" class="small" style="margin-top:10px;color:var(--muted)"></div>
    </form>
  `;

  $('#work-form').addEventListener('submit', async e=>{
    e.preventDefault();
    const vaga = $('#vaga').value;
    const file = $('#cv').files && $('#cv').files[0];
    if(EMAILJS_ENABLED && EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID && EMAILJS_PUBLIC_KEY){
      try{
        emailjs.init(EMAILJS_PUBLIC_KEY);
        let templateParams = { vaga, message: 'Envio de currículo via site.' };
        if(file){
          const base64 = await fileToBase64(file);
          templateParams['attachment'] = base64;
          templateParams['filename'] = file.name;
        }
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
        $('#work-status').textContent = 'Currículo enviado com sucesso (EmailJS).';
      }catch(err){
        $('#work-status').textContent = 'Falha no envio automático. Abrindo cliente de e-mail...';
        fallbackMail(vaga);
      }
    } else {
      fallbackMail(vaga);
      $('#work-status').textContent = 'Abrindo cliente de e-mail. Anexe o arquivo manualmente se necessário.';
    }
  });
  $('#clear-cv').addEventListener('click', ()=>{ $('#cv').value=''; $('#work-status').textContent=''; });
}

function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = ()=> resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
function fallbackMail(vaga){
  const body = encodeURIComponent(`Vaga: ${vaga}\n\nPor favor, anexe o currículo no seu cliente de e-mail caso não consiga enviar automaticamente.`);
  const mailto = `mailto:llrdsll@gmail.com?subject=Curriculo - ${encodeURIComponent(vaga)}&body=${body}`;
  window.location.href = mailto;
}

/* =========================
   Modal & Cart Panel (com + / - quantidade e preço por tamanho)
   ========================= */
function openProductModal(product){
  const ov = $('#overlays');
  // build options list with data-price
  const options = product.sizes.map(s => `<option data-price="${s.price}">${s.name} — ${formatMoney(s.price)}</option>`).join('');
  ov.innerHTML = `
    <div class="overlay" id="modal-overlay">
      <div class="modal" role="dialog" aria-modal="true">
        <img src="${product.img}" alt="${product.title}" onerror="this.src='https://source.unsplash.com/800x800/?product'">
        <div style="flex:1">
          <h3 style="margin:0">${product.title}</h3>
          <div class="price" id="modal-price">${formatMoney(product.sizes[0].price)}</div>
          <p class="small" style="margin:8px 0 12px">Escolha o tamanho e a quantidade.</p>
          <label>Escolha o tamanho</label>
          <select id="modal-size" style="margin-top:6px;width:100%;max-width:260px">
            ${options}
          </select>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
            <label class="small">Qtd</label>
            <input type="number" id="modal-qty" min="1" value="1" style="width:88px;padding:8px;border-radius:8px;border:1px solid #e6e6e6">
          </div>
          <div style="margin-top:12px;display:flex;gap:10px">
            <button class="btn btn-primary" id="modal-add">Adicionar ao carrinho</button>
            <button class="btn btn-outline" id="modal-close">Fechar</button>
          </div>
        </div>
      </div>
    </div>
  `;
  const sizeSelect = $('#modal-size');
  const modalPrice = $('#modal-price');
  // update shown price when size changes
  sizeSelect.addEventListener('change', ()=>{
    const opt = sizeSelect.selectedOptions[0];
    const p = Number(opt.dataset.price);
    modalPrice.textContent = formatMoney(p);
  });
  $('#modal-close').addEventListener('click', ()=>{ ov.innerHTML=''; });
  $('#modal-overlay').addEventListener('click', (ev)=>{ if(ev.target.id==='modal-overlay') ov.innerHTML=''; });
  $('#modal-add').addEventListener('click', ()=>{
    const qty = Math.max(1, parseInt($('#modal-qty').value || 1));
    const opt = $('#modal-size').selectedOptions[0];
    const sizeName = opt.textContent.split(' — ')[0].trim();
    const price = Number(opt.dataset.price);
    addToCart(product, { name: sizeName, price }, qty);
    ov.innerHTML='';
    openCartPanel();
  });
}

/* Cart panel rendering */
let cartPanelVisible = false;
function openCartPanel(){ cartPanelVisible = true; renderCartPanel(); }
function closeCartPanel(){ cartPanelVisible = false; const p = document.getElementById('cart-panel'); if(p) p.remove(); }
$('#cart-btn').addEventListener('click', ()=>{ cartPanelVisible = !cartPanelVisible; if(cartPanelVisible) renderCartPanel(); else closeCartPanel(); });

function renderCartPanel(){
  const ov = $('#overlays');
  const old = document.getElementById('cart-panel'); if(old) old.remove();
  const panel = document.createElement('div');
  panel.id = 'cart-panel'; panel.className = 'cart-panel';
  panel.innerHTML = `
    <h3 style="margin:0 0 8px">Seu pedido</h3>
    <div id="cart-items" style="max-height:300px;overflow:auto"></div>
    <div style="margin-top:10px;border-top:1px solid #f1f1f1;padding-top:10px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="small">Total</div>
        <div style="font-weight:700" id="cart-total">${formatMoney(cartTotal())}</div>
      </div>
      <div class="cart-actions" style="margin-top:10px">
        <button class="btn" id="clear-cart">Limpar</button>
        <button class="btn btn-primary" id="checkout">Comprar no WhatsApp</button>
      </div>
    </div>
  `;
  ov.appendChild(panel);

  const itemsBox = panel.querySelector('#cart-items');
  if(cart.length === 0) {
    itemsBox.innerHTML = '<div class="small">Nenhum produto no carrinho.</div>';
  } else {
    itemsBox.innerHTML = cart.map((it, idx)=>`
      <div class="cart-item" data-idx="${idx}">
        <img src="${it.img}" alt="${it.title}" onerror="this.src='https://source.unsplash.com/200x200/?product'">
        <div style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:600">${it.title}</div>
            <button class="remove-ghost" data-idx="${idx}" title="Remover item">remover</button>
          </div>
          <div class="small" style="color:var(--muted)">${it.sizeName}</div>
          <div class="qty-control">
            <button class="qty-btn qty-decrease" data-idx="${idx}" aria-label="Diminuir quantidade">−</button>
            <div class="qty-number" id="qty-${idx}">${it.qty}</div>
            <button class="qty-btn qty-increase" data-idx="${idx}" aria-label="Aumentar quantidade">+</button>
          </div>
        </div>
        <div style="font-weight:700" id="line-total-${idx}">${formatMoney(it.price * it.qty)}</div>
      </div>
    `).join('');
  }

  // listeners: decrease / increase
  panel.querySelectorAll('.qty-decrease').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const idx = parseInt(e.currentTarget.dataset.idx);
      if(!Number.isInteger(idx)) return;
      if(cart[idx].qty > 1){
        cart[idx].qty = cart[idx].qty - 1;
        saveCart();
      } else {
        removeFromCart(idx);
      }
    });
  });
  panel.querySelectorAll('.qty-increase').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const idx = parseInt(e.currentTarget.dataset.idx);
      if(!Number.isInteger(idx)) return;
      cart[idx].qty = cart[idx].qty + 1;
      saveCart();
    });
  });

  // remove buttons
  panel.querySelectorAll('.remove-ghost').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const idx = parseInt(e.currentTarget.dataset.idx);
      if(!Number.isInteger(idx)) return;
      removeFromCart(idx);
    });
  });

  panel.querySelector('#clear-cart').addEventListener('click', ()=>{ clearCart(); renderCartPanel(); });
  panel.querySelector('#checkout').addEventListener('click', ()=>{
    if(cart.length === 0){ alert('Carrinho vazio'); return; }
    // build message with backticks for fields
    const lines = ['*Orçamento pelo site*',''];
    cart.forEach(it => lines.push(`• ${it.title} - ${it.sizeName} x${it.qty} = ${formatMoney(it.price*it.qty)}`));
    lines.push('','*Total:* ' + formatMoney(cartTotal()), '','Nome: ```','Telefone: ```','Endereço: ```');
    const text = encodeURIComponent(lines.join('\n'));
    const url = `https://wa.me/${WA_NUMBER}?text=${text}`;
    window.open(url, '_blank');
  });
}

/* =========================
   Init & Router
   ========================= */
function renderRoute(){
  setActiveNav();
  const route = currentRoute();
  if(route === '/' || route === '') renderHome();
  else if(route.startsWith('/loja')) renderLoja();
  else if(route.startsWith('/blog')) renderBlog();
  else if(route.startsWith('/sobre')) renderSobre();
  else if(route.startsWith('/trabalhe')) renderTrabalhe();
  else renderHome();
}

window.addEventListener('hashchange', renderRoute);
$('#home-link').addEventListener('click', ()=>navigateTo('/'));
$$('.nav-link').forEach(a => a.addEventListener('click', (e)=> { e.preventDefault(); const href = a.getAttribute('href') || a.dataset.route || ''; navigateTo(href.replace('#','')); }));

document.getElementById('year').textContent = new Date().getFullYear();
loadCart();
renderRoute();

</script>
</body>
</html>
